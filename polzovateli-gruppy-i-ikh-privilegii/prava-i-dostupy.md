# Права и доступы

Разграничение прав доступа в операционных системах, таких как Linux, Windows и macOS, является важной частью обеспечения безопасности системы и защиты данных пользователей от несанкционированного доступа.

В многопользовательской системе каждый пользователь имеет свои файлы и папки, к которым другие пользователи могут получить доступ только при наличии соответствующих разрешений.

Обычные пользователи не должны иметь возможность изменять важные системные файлы, так как это может привести к сбоям в работе операционной системы или даже её полной поломке. Ограничивая права доступа для обычных пользователей, администраторы предотвращают подобные инциденты.

**Принцип наименьших привилегий.** Каждому пользователю или процессу следует предоставлять ровно столько прав, сколько необходимо для выполнения их задач. Если злоумышленник получит доступ к учетной записи обычного пользователя, он сможет выполнять ограниченное количество операций. В случае взлома аккаунта администратора последствия будут гораздо серьёзнее.

#### Права владельца файла, группы и все остальные

Если попытаться под обычным пользователем просмотреть файл /etc/shadow, в котором хранятся пароли, то мы получим ошибку доступа.

```bash
gerasin@DESKTOP-9IF30U0:~$ cat /etc/shadow
cat: /etc/shadow: Permission denied
```

Обычный пользователь не имеет прав для работы с данным файлом.

В модели безопасности Unix пользователи могут быть владельцами файлов и директорий. Владельцы имеют возможность контролировать доступ к этим ресурсам. Также пользователи могут входить в группу, включающую одного или нескольких участников, и получать доступ к файлам и директориям на основе прав, установленных владельцем для этой группы. Помимо этого, владельцы могут задать определенные права доступа для всех остальных пользователей.

**Виды прав**

Всего существует 3 вида прав:

* Права на чтение (r)
* Права на завись (w)
* Права на выполнение (x)

Посмотрим какие права доступны для файла `/etc/shadow`.

```bash
gerasin@DESKTOP-9IF30U0:~$ ls -l /etc/shadow
-rw-r----- 1 root shadow 715 Feb 11 19:41 /etc
```

Первые 10 символов в выводе — это атрибуты файла. Первый из этих символов определяет тип файла.

Остальные девять символов в атрибутах файла называются режимом доступа к файлу и представляют права на чтение, запись и выполнение для владельца фай- ла, группы — владельца файла и всех остальных.

```bash
rwx rwx rwx
```

Для файла `/etc/shadow` можно сказать, что его пользователь-владелец `root` и группа `shadow`. Владелец имеет права на чтение и запись файла (`rw-`). Пользователи группы shadow имеют права на чтение файла (`r--`). Остальные пользователи, которые не состоят в группе `shadow` не имеют прав на файл (`---`).

```bash
gerasin@DESKTOP-9IF30U0:~$ > file.txt
gerasin@DESKTOP-9IF30U0:~$ ls -l file.txt
-rw-r--r-- 1 gerasin gerasin 0 Feb 12 12:22 file.txt
```

Создатель файла становится его владельцем. Автоматически права распространяются на первичную группу владельца. В данном случае владелец `gerasin` имеет права на чтение и запись. Члены группы `gerasin` и остальные пользователя имеют одинаковые права на чтение.

Интересный момент с правами у символических ссылок.

```bash
gerasin@DESKTOP-9IF30U0:~$ ln -s file.txt link_file.txt
gerasin@DESKTOP-9IF30U0:~$ ls -l link_file.txt
lrwxrwxrwx 1 gerasin gerasin 8 Feb 12 12:29 link_file.txt -> file.txt
gerasin@DESKTOP-9IF30U0:~$ ls -l file.txt
-rw-r--r-- 1 gerasin gerasin 0 Feb 12 12:22 file.txt
```

В Linux права доступа у символьных ссылок работают немного по-другому, чем у обычных файлов и директорий. Символическая ссылка (symlink) сама по себе всегда имеет права `lrwxrwxrwx`. Реальные права проверяются для целевого файла/директории, на который указывает ссылка. В данном случае `link_file.txt` символическая ссылка, `file.txt` целевой файл. При этом доступы `link_file.txt` будет определяться через `file.txt`.

#### Изменение прав доступа

В Linux права доступа к файлам и директориям представлены в восьмеричной системе счисления. Эти права могут быть установлены для трех категорий пользователей: владелец, группа и остальные.

Комбинации прав:

| rwx | Восьмеричное значение | Описание                   |
| --- | --------------------- | -------------------------- |
| rwx | 7                     | Чтение, запись, выполнение |
| rw- | 6                     | Чтение и запись            |
| r-x | 5                     | Чтение и выполнение        |
| r-- | 4                     | Только чтение              |
| -wx | 3                     | Запись и выполнение        |
| -w- | 2                     | Только запись              |
| --x | 1                     | Только выполнение          |
| --- | 0                     | Нет прав                   |

Давайте установим файлу file.txt права группы на выполнение с помощью команды `chmod`.

```bash
gerasin@DESKTOP-9IF30U0:~$ chmod 614 file.txt
gerasin@DESKTOP-9IF30U0:~$ ls -l file.txt
-rw---xr-- 1 gerasin gerasin 0 Feb 12 12:22 file.txt
```

Аргумент `614` устанавливает права для владельца на чтение и запись (rw-), для группы на выполнение (--x) и для всех остальных на чтение (r--). На практике используются 5 самых шаблонов: 7,6,5,4 и 0.

Команда `chmod` поддерживает символьную форму задачи прав. Такая запись делится на 3 части:

* кому изменить права
* добавить или убрать
* какие права

Чтобы указать, для кого устанавливаются разрешения, используется комбинация символов `u`, `g`, `o` и `a`:

* `u` - пользователь (владелец)
* `g` - группа
* `o` - остальные
* `a` - для всех

Для определение убрать иди добавить права используются знаки `+`, `-` и `=`. Знак =, указывает, что только заданные разрешения должны быть установлены, а все остальные отобраны.

Установим все права для всех.

```bash
gerasin@DESKTOP-9IF30U0:~$ chmod a+rwx file.txt
gerasin@DESKTOP-9IF30U0:~$ ls -l file.txt
-rwxrwxrwx 1 gerasin gerasin 0 Feb 12 12:22 file.txt
```

Вернем права по умолчанию.

```bash
gerasin@DESKTOP-9IF30U0:~$ chmod u-x,go-wx file.txt
gerasin@DESKTOP-9IF30U0:~$ ls -l file.txt
-rw-r--r-- 1 gerasin gerasin 0 Feb 12 12:22 file.txt
```

В примере забираются права на выполнение у владельца, и права на выполнение и запись у группы и остальных.

```bash
gerasin@DESKTOP-9IF30U0:~$ ls -l file.txt
-rw-rw-r-- 1 gerasin gerasin 0 Feb 12 12:22 file.txt

```

В примере выше добавили права группе на чтение и запись.

Если нужно изменить права доступа каталогу и всем файлам в ней нужно использовать параметр --recursive.

```bash
gerasin@DESKTOP-9IF30U0:~$ ls -l project/
total 3
-rw-r--r-- 1 gerasin gerasin    0 Feb 12 16:31 f.txt
-rw-r--r-- 1 gerasin gerasin    0 Feb 12 16:31 g.txt
-rw-r--r-- 1 gerasin gerasin    0 Feb 12 16:31 h.txt
```

```bash
gerasin@DESKTOP-9IF30U0:~$ chmod a+rwx project/
gerasin@DESKTOP-9IF30U0:~$ ls -lt
drwxrwxrwx 3 gerasin gerasin 4096 Feb 12 16:31 project
```

Как видно из примера каталогу `project` установили все права для всех.

```bash
gerasin@DESKTOP-9IF30U0:~$ ls -l project/
-rw-r--r-- 1 gerasin gerasin    0 Feb 12 16:31 f.txt
-rw-r--r-- 1 gerasin gerasin    0 Feb 12 16:31 g.txt
-rw-r--r-- 1 gerasin gerasin    0 Feb 12 16:31 h.txt
```

Но файлы в каталоге `project` не поменяли права. Если нужно изменить права доступа каталогу и всем файлам в ней нужно использовать параметр `--recursive`.

```bash
gerasin@DESKTOP-9IF30U0:~$ chmod a+rwx project/ --recursive
gerasin@DESKTOP-9IF30U0:~$ ls -l project/
-rwxrwxrwx 1 gerasin gerasin    0 Feb 12 16:31 f.txt
-rwxrwxrwx 1 gerasin gerasin    0 Feb 12 16:31 g.txt
-rwxrwxrwx 1 gerasin gerasin    0 Feb 12 16:31 h.txt
```

{% hint style="danger" %}
Применять параметр `--recursive` не самое хорошее решение. Лучше придерживаться принципа наименьшей ответственности.
{% endhint %}

