# Пользователи, группы и другие

В Linux система прав доступа к файлам и директориям основана на трех основных категориях пользователей: **владелец**, **группа** и **остальные**.

1. **Владелец (owner)** — это пользователь, который создал файл или директорию. Владелец имеет определенные права: чтение, запись, выполнение.
2. **Группа (oroup)** — это набор пользователей, которые имеют общие права доступа к файлам иди директориям. Каждый файл или директория принадлежит не только владельцу, но и группе.
3. **Остальные (others/world)** — это все пользователи, которые не являются ни владельцем, ни членами группы.

Следуя модели безопасности Unix если пользователь владеет файлом или каталогом, он может управлять доступом к нему.

Для получения информации о пользователе используется команда `id`

```bash
gerasin@DESKTOP-9IF30U0:~$ id
uid=1000(gerasin) gid=1000(gerasin) groups=1000(gerasin),4(adm),24(cdrom),27(sudo),30(dip),46(plugdev),100(users),997(docker)
```

Каждый пользователь системы имеет уникальный `uid` (User ID). Он присваивается автоматически при создании пользователя. У каждой группы есть уникальный `gid` (Group ID). Он также присваивается автоматически при создании пользователя. Пользователь может быть включен в несколько групп. Группа, которая присваивается при его создании называется основной (primary group). uid и gid обычно совпадают. В примере выше uid равно 1000, gid равно 1000. Кроме группы `gerasin` пользователь включен в другие группы: `4(adm), 24(cdrom), 27(sudo), 30(dip), 46(plugdev), 100(users), 997(docker)`. Цифра слева от скобок с названием группы отображает ее gid.

Создание отдельной группы для каждого пользователя позволяет изолировать права доступа: файлы, созданные пользователем, по умолчанию доступны только ему самому, а не всем членам общей группы. Если бы все пользователи по умолчанию принадлежали к общей группе (например, `users`), то любые файлы, созданные одним пользователем, могли бы быть доступны другим пользователям этой группы.

Если нужно предоставить доступ к определенным файлам нескольким пользователям, можно просто добавить этих пользователей в дополнительную группу, не затрагивая их основные группы.

Список всех пользователей системы находится в файле `/etc/passwd`.

```bash
gerasin@DESKTOP-9IF30U0:~$ cat /etc/passwd
root:x:0:0:root:/root:/bin/bash
.
.
.
gerasin:x:1000:1000:,,,:/home/gerasin:/bin/bash
```

Что содержится в строке \`gerasin:x:1000:1000:,,,:/home/gerasin:/bin/bash:

1. **`gerasin`** — имя пользователя (username). В данном случае имя пользователя — `gerasin`.
2. **`x`** — поле для хранения пароля пользователя. Значение `x` указывает, что сам пароль хранится в защищенном файле `/etc/shadow`, а не прямо в `/etc/passwd`.
3. **`1000`** — uid
4. **`1000`** — gid
5. **`,,,`** — поле для **комментария** или дополнительной информации о пользователе (например, полное имя, номер телефона и т.д.). В данном случае это поле пустое, но формально оставлено как три запятые для соблюдения формата.
6. **`/home/gerasin`** — домашняя директория пользователя.
7. **`/bin/bash`** — оболочка, которая будет запущена при входе пользователя в систему.

Список всех групп системы находится в файле `/etc/group`.

```bash
gerasin@DESKTOP-9IF30U0:~$ cat /etc/group
root:x:0:
.
.
.
gerasin:x:1000:
```

Каждая строка в файле `/etc/group` содержит четыре поля, разделенных двоеточиями (`:`):

1. `gerasin` — имя группы.
2. **`x`** — указывает, что пароль для этой группы хранится в защищенном файле `/etc/gshadow`. Если здесь стоит пустая строка (`""`), это означает, что пароль отсутствует или не используется.
3. `1000` — gid
4. **Список пользователей** — pдесь перечисляются пользователи, которые принадлежат к этой группе. Пользователи разделяются запятыми. В данном случае список пустой, что означает, что дополнительные пользователи (кроме владельца группы) не добавлены в группу.

**Добавление новых пользователей**

Для добавления нового пользователя есть команда `useradd`.

```bash
gerasin@DESKTOP-9IF30U0:~$ sudo useradd my-new-user -s /bin/bash
gerasin@DESKTOP-9IF30U0:~$ sudo cat /etc/passwd
.
.
.
my-new-user:x:1003:1003::/home/my-new-user:/bin/bash
```

`-s /bin/bash` - указывает с какой программной оболочкой оболочкой создать пользователя. В данном случае `bash`. По умолчанию `bin/sh`.

Для удаления пользователя используется команда `userdel`.

```bash
gerasin@DESKTOP-9IF30U0:~$ sudo userdel my-new-user
```

По умолчанию пароль для нового пользователя не задан. Для установки пароль используется команда `passwd`.

```bash
sudo passwd my-new-user
New password:
Retype new password:
passwd: password updated successfully
```

{% hint style="warning" %}
При вводе пароля в терминале Linux (и большинстве других Unix-подобных систем) символы не отображаются по соображениям безопасности
{% endhint %}

Для смены пользователя используется команда `su`.

```bash
su my-new-user
Password:
```

**Добавление новых групп**

Для создания новой группы используется команда `groupadd`.

```bash
sudo groupadd new-group
```

Можно указать конкретный идентификатор группы `gid` с помощью параметра `-g`:

```bash
sudo groupadd -g 5555 new-group
```

**Добавление пользователей в группы**

Для добавление пользователя в группу используется команда `usermod`.

```bash
gerasin@DESKTOP-9IF30U0:~$ sudo usermod -aG new-group evgenii
```

* `-a` — означает "append" (добавить пользователя в дополнительную группу, не удаляя его из других групп).
* `-G` — указывает, что нужно работать с дополнительными группами (не с основной).
* `<имя_группы>` — имя группы, в которую нужно добавить пользователя (new-group).
* `<имя_пользователя>` — имя пользователя, которого нужно добавить (evgenii).

```bash
gerasin@DESKTOP-9IF30U0:~$ id evgenii
uid=1002(evgenii) gid=1002(evgenii) groups=1002(evgenii),1002(new-group)
```

Для изменения основной группы используется флаг `-g`.

```bash
sudo usermod -g new-group evgenii
gerasin@DESKTOP-9IF30U0:~$ id evgenii
uid=1002(evgenii) gid=1002(new-group) groups=1002(new-group)
```
